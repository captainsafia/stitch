+++
id = "S-20251228-8794"
title = "Fix npm build error with Bun builtins"
status = "closed"
created_at = "2025-12-28T19:06:16.445Z"
updated_at = "2025-12-28T19:08:48.360Z"
provenance = "agent"
confidence = "high"
tags = ["build", "npm", "bun"]

[scope]
paths = ["package.json"]

[[git.links]]
kind = "commit"
sha = "e43ecc5d67501c3b66c1bc6b2e7acb69f40941f6"
+++

## Intent

Fix the npm build error caused by using `--target node` when the codebase uses Bun-specific APIs.

## Problem

The build script was configured with `--target node`:
```bash
bun build src/api.ts --outdir dist --target node
```

This failed because `src/core/git.ts` imports Bun's `$` shell:
```typescript
import { $ } from "bun";
```

Bun builtins cannot be bundled for Node.js targets.

## Solution

Changed the build target from `node` to `bun`:
```bash
bun build src/api.ts --outdir dist --target bun
```

This is the correct approach since stitch is designed as a Bun-native tool throughout (CLI compilation, tests, etc.).

## Alternatives Considered

1. **Refactor to use Node.js child_process** - Would require rewriting `git.ts` to avoid Bun's `$` shell. Rejected because it goes against the project's Bun-first philosophy.

2. **Conditional imports with runtime detection** - Too complex for the benefit, and the tool is meant to run on Bun anyway.

## Notes

- All 64 tests continue to pass
- Typecheck passes
- Build completes successfully
