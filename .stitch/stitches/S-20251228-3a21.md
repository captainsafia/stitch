+++
id = "S-20251228-3a21"
title = "Add condition to release.yml to publish to npm only if repo is public"
status = "open"
created_at = "2025-12-28T21:45:09.842Z"
updated_at = "2025-12-28T21:47:13.510Z"
provenance = "human"
confidence = "medium"

[[git.links]]
kind = "commit"
sha = "99aa35abbfad67c71b9d0470b2f878d5b4fd005a"

[[git.links]]
kind = "commit"
sha = "9fd8f29c766dfe62e96f5bc83da751afe98ca2fb"
+++

## Intent

Add a condition to the GitHub Actions release workflow so that npm publishing only happens when the repository is public. This prevents publishing private repository packages to the public npm registry.

## Constraints

- Must respect the rules in AGENTS.md (use stitch to record intent)
- Must be a minimal change to the workflow
- Must not affect other parts of the release process (GitHub releases, binary uploads)
- Must work for both preview and stable releases

## Alternatives

- Could use `github.event.repository.visibility == 'public'` instead of `github.event.repository.private == false`
- Could skip the entire prerelease/release jobs, but this would also skip GitHub releases which should still happen
- Could use a matrix strategy to conditionally include npm publishing step

## Notes

The condition `github.event.repository.private == false` is used because:
1. It's a direct boolean check that's clearer than checking visibility string
2. It's available in all GitHub Actions events that include repository context
3. A private repository has `private: true`, so `false` means public

The change affects two steps in release.yml:
- Line 208: Preview npm publishing step in the `prerelease` job
- Line 273: Stable npm publishing step in the `release` job
