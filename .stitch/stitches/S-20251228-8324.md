+++
id = "S-20251228-8324"
title = "Update macOS signing flow to follow grove patterns"
status = "open"
created_at = "2025-12-28T18:35:00.000Z"
updated_at = "2025-12-28T18:40:00.000Z"
provenance = "agent"
confidence = "high"
tags = ["ci", "macos", "signing", "notarization"]

[scope]
paths = [".github/workflows/release.yml", ".github/workflows/pr-publish.yml", ".github/workflows/assets/entitlements.plist"]
+++

## Intent

Update the macOS code signing workflow to follow the patterns established in the grove project. This includes better keychain management, dynamic identity discovery, entitlements, and full notarization support.

## Changes

### New files
- `.github/workflows/assets/entitlements.plist` - Entitlements for JIT and unsigned executable memory (required for Bun runtime)

### Workflow updates
Restructured macOS signing into three separate steps:

1. **Import Code Signing Certificate**
   - Generate random keychain password with `openssl rand`
   - Use `$RUNNER_TEMP` for temporary files
   - Import certificate with `-A -t cert -f pkcs12` flags

2. **Sign macOS Binaries**
   - Use `security find-identity` to discover signing identity dynamically
   - Sign with entitlements file for proper runtime permissions
   - Verify signatures after signing

3. **Notarize macOS Binaries**
   - Zip binaries for notarization
   - Extract team ID from signing identity
   - Submit to Apple notarization service with `xcrun notarytool`
   - Wait for notarization to complete

### Secret name changes
- `MACOS_CERTIFICATE` → `MACOS_CERT_P12_BASE64`
- `MACOS_CERTIFICATE_PASSWORD` → `MACOS_CERT_P12_PASSWORD`
- `KEYCHAIN_PASSWORD` → (no longer needed, generated randomly)
- New: `APPLE_ID_EMAIL`
- New: `APPLE_APP_SPECIFIC_PASSWORD`

## Constraints

- Signing requires Developer ID Application certificate
- Notarization requires Apple ID with app-specific password
- Entitlements must allow JIT for Bun-compiled binaries
- Each step is conditional on its required secrets

## Notes

Required GitHub Secrets:
- `MACOS_CERT_P12_BASE64` - Base64-encoded .p12 certificate
- `MACOS_CERT_P12_PASSWORD` - Password for the .p12 file
- `APPLE_ID_EMAIL` - Apple ID email for notarization
- `APPLE_APP_SPECIFIC_PASSWORD` - App-specific password for notarization
